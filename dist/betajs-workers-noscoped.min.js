/*!
betajs-workers - v0.0.1 - 2016-10-04
Copyright (c) Oliver Friedmann
Apache-2.0 Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS.Workers"),a.binding("base","global:BetaJS"),a.define("module:",function(){return{guid:"9f1e96ea-528c-4110-83f8-76fa9a8900d3",version:"1.1475608783940"}}),a.assumeVersion("base:version",557),a.define("module:Common.AugmentedWorker",["base:Class","base:Events.EventsMixin","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},[b,function(a){return{constructor:function(b,d){a.constructor.call(this),this.__worker=b,this.__augments={},this.__handlers={},this.__receive={},d.forEach(function(a){var b=this.auto_destroy(new this.cls.augments[a](this));this.__augments[a]=b,c.iter(b.intf,function(a,c){this.__receive[c]=b},this)},this);var e=this;this.__worker.addEventListener("message",function(a){a.data.augment?e._receiveAugment(a.data.augment.message,a.data.augment.data):a.data.data&&e.trigger("message",a.data)})},postMessage:function(a,b){this.__worker.postMessage({data:a},b)},addEventListener:function(a,b){return"message"===a?this.on(a,function(a){b.call(this,a)},this):this.on(a,b),this},augmentCall:function(a,b){this.__worker.postMessage({augment:{message:a,data:b}})},_receiveAugment:function(a,b){var c=this.__receive[a];c&&c[a].apply(c,b)}}}],{augments:{}})}),a.define("module:Common.WorkerAugment",["base:Class","base:Functions","module:Common.AugmentedWorker"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b){a.constructor.call(this),this._parent=b},intf:{},augmentCall:function(a){this._parent.augmentCall(a,b.getArguments(arguments,1))}}},{register:function(a){return c.augments[a]=this,this}})}),a.define("module:Common.WorkerSenderChannel",["base:Channels.Sender","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this.__worker=b||self},_send:function(a,c,d){var e=[];d&&b.iter(d,function(a,b){a&&a.transfer&&c[b]&&e.push(c[b])},this),this.__worker.postMessage({message:a,data:c},e)}}})}),a.define("module:Common.WorkerReceiverChannel",["base:Channels.Receiver"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__worker=b||self;var c=this;this.__worker.addEventListener("message",function(a){c._receive(a.data.message,a.data.data)})}}})}),a.define("module:Host.TimerAugment",["module:Common.WorkerAugment"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this,b),this.__timeouts={},this.__intervals={}},destroy:function(){Objs.iter(this.__timeouts,function(a){clearTimeout(a)}),Objs.iter(this.__timeouts,function(a){clearTimeout(a)}),a.destroy.call(this)},intf:{setTimeout:function(a,b){var c=this;this.__timeouts[a]=setTimeout(function(){c.augmentCall("timeoutCallback",a),delete c.__timeouts[a]},b)},setInterval:function(a,b){var c=this;this.__intervals[b]=setInterval(function(){c.augmentCall("intervalCallback",b)},a)},clearTimeout:function(a){a in this.__timeouts&&(clearTimeout(this.__timeouts[a]),delete this.__timeouts[a])},clearInterval:function(a){a in this.__intervals&&(clearInterval(this.__intervals[a]),delete this.__intervals[a])}}}}).register("host:timer")}),a.define("module:Host.PseudoWorker",["base:Class","base:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,{bind:function(a){return this.__peer=a,this},postMessage:function(a,b){this.__peer.triggerAsync("message",a)},addEventListener:function(a,b){return"message"===a?this.on(a,function(a){b.call(this,{data:a})},this):this.on(a,b),this}}],{createWorker:function(a){try{return new Worker(a)}catch(b){return null}},createPseudoWorker:function(a,b){var c=new this,d=c.auto_destroy(new this);return c.bind(d),d.bind(c),a.call(b||this,d),c},createAsFallback:function(a,b,c){return this.createWorker(a)||this.createPseudoWorker(b,c)}})}),a.define("module:Client.TimerAugment",["module:Common.WorkerAugment","base:Functions","base:Objs"],function(b,c,d,e){return b.extend({scoped:e},function(b){return{constructor:function(e){b.constructor.call(this,e);this.__id=0,this.__names=[],this.__callbacks={},d.iter(this.send,function(b,d){a.getGlobal(d)||(a.setGlobal(d,c.as_method(b,this)),this.__names.push(d))},this)},send:{setTimeout:function(a,b){return this.__id++,this.__callbacks[this.__id]=a,this.augmentCall("setTimeout",this.__id,b),this.__id},setInterval:function(a,b){return this.__id++,this.__callbacks[this.__id]=a,this.augmentCall("setTimeout",this.__id,b),this.__id},clearTimeout:function(a){this.augmentCall("clearTimeout",a),delete this.__callbacks[a]},clearInterval:function(a){this.augmentCall("clearInterval",a),delete this.__callbacks[a]}},destroy:function(){d.iter(this.__names,function(b){a.setGlobal(b,null)}),b.destroy.call(this)},intf:{timeoutCallback:function(a){this.__callbacks[a]&&(this.__callbacks[a].call(this),delete this.__callbacks[a])},intervalCallback:function(a){this.__callbacks[a]&&this.__callbacks[a].call(this)}},receive:["timeoutCallback","intervalCallback"]}}).register("client:timer")})}).call(Scoped);